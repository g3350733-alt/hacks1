--// Player Highlight + POV Lock Script
--// LocalScript - StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local highlightsEnabled = false
local povLockEnabled = false
local highlights = {}
local povConnection = nil

--// GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PlayerToolsGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Highlight Button
local HighlightButton = Instance.new("TextButton")
HighlightButton.Size = UDim2.new(0, 170, 0, 50)
HighlightButton.Position = UDim2.new(0, 20, 0.5, -60)
HighlightButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
HighlightButton.TextColor3 = Color3.fromRGB(255,255,255)
HighlightButton.TextScaled = true
HighlightButton.Font = Enum.Font.GothamBold
HighlightButton.Text = "Highlight: OFF"
HighlightButton.Parent = ScreenGui
HighlightButton.Active = true
HighlightButton.Draggable = true

-- POV Button
local POVButton = Instance.new("TextButton")
POVButton.Size = UDim2.new(0, 170, 0, 50)
POVButton.Position = UDim2.new(0, 20, 0.5, 5)
POVButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
POVButton.TextColor3 = Color3.fromRGB(255,255,255)
POVButton.TextScaled = true
POVButton.Font = Enum.Font.GothamBold
POVButton.Text = "POV Lock: OFF"
POVButton.Parent = ScreenGui
POVButton.Active = true
POVButton.Draggable = true

--// Highlight Logic
local function addHighlight(character)
	if not character or character == LocalPlayer.Character then return end
	if highlights[character] then return end

	local hl = Instance.new("Highlight")
	hl.FillColor = Color3.fromRGB(255,0,0)
	hl.OutlineColor = Color3.fromRGB(255,255,255)
	hl.FillTransparency = 0.5
	hl.Adornee = character
	hl.Parent = character

	highlights[character] = hl
end

local function removeAllHighlights()
	for _, hl in pairs(highlights) do
		if hl then hl:Destroy() end
	end
	table.clear(highlights)
end

local function highlightAllPlayers()
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			addHighlight(player.Character)
		end
	end
end

--// Closest Player Finder
local function getClosestPlayer()
	local closest = nil
	local shortest = math.huge
	local myChar = LocalPlayer.Character
	local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")

	if not myRoot then return nil end

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			local root = player.Character:FindFirstChild("HumanoidRootPart")
			if root then
				local dist = (myRoot.Position - root.Position).Magnitude
				if dist < shortest then
					shortest = dist
					closest = root
				end
			end
		end
	end

	return closest
end

--// POV Lock Logic
local function enablePOVLock()
	povConnection = RunService.RenderStepped:Connect(function()
		local target = getClosestPlayer()
		if target then
			Camera.CameraType = Enum.CameraType.Scriptable
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
		end
	end)
end

local function disablePOVLock()
	if povConnection then
		povConnection:Disconnect()
		povConnection = nil
	end
	Camera.CameraType = Enum.CameraType.Custom
end

--// Button Events
HighlightButton.MouseButton1Click:Connect(function()
	highlightsEnabled = not highlightsEnabled
	if highlightsEnabled then
		HighlightButton.Text = "Highlight: ON"
		HighlightButton.BackgroundColor3 = Color3.fromRGB(0,170,0)
		highlightAllPlayers()
	else
		HighlightButton.Text = "Highlight: OFF"
		HighlightButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
		removeAllHighlights()
	end
end)

POVButton.MouseButton1Click:Connect(function()
	povLockEnabled = not povLockEnabled
	if povLockEnabled then
		POVButton.Text = "POV Lock: ON"
		POVButton.BackgroundColor3 = Color3.fromRGB(0,170
